FROM alpine:3.20.0 as base

ARG MAINTAINER
ARG VERSION

LABEL DCU_MAINTAINER="${MAINTAINER}"
LABEL DCU_VERSION="${VERSION}"

ENV DCU_MAINTAINER="${MAINTAINER}"
ENV DCU_VERSION="${VERSION}"

RUN apk update && \
apk add \
    jq \
    curl \
    coreutils \
    ncurses \
    wget \
    which \
    unzip \
    bash \
    gawk \
    grep \
    docker \
    postfix \
&& rm -rf /var/cache/apk/* 

WORKDIR /opt/docker_container_updater
COPY ./LICENSE /opt/docker_container_updater/LICENSE
COPY ./entrypoint.sh /opt/docker_container_updater/entrypoint.sh
COPY ./container_update.sh /opt/docker_container_updater/container_update.sh
RUN chmod ugo+x container_update.sh entrypoint.sh
RUN echo "relayhost = [$DCU_MAIL_RELAYHOST]" >> /etc/postfix/main.cf
CMD ["postfix", "start"]

ENTRYPOINT [ "/opt/docker_container_updater/entrypoint.sh" ]
